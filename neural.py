#Import
import numpy as np
from model import createModel
from test import test
from data import createData, inputCheck
np.set_printoptions(suppress=True)

print("じゃんけんの手を入力してください\r\n古い->新しい,1=グー 2=チョキ 3=パーを区切りなしで\r\n50個数以上登録してください\r\n1,2,3,s以外を入力するとs君\r\nsを入力するとさざえ")
inp = input()

if inputCheck(inp):
    history = inp
elif inp=="s":
    history = str(1232113213123122312312311231321231133123121332213212231332131213312121311232331212233211112312132231123113223132113121233211332231213321232132231123132113321232131321312232133213212332112321331221323312231132312213232113233122131233211232312122313322131123211323311221323132121332123312321132213121332123221321231132321331221332132213231123213232113231233221323112323132213123211321211332131213332132122231131322331211223112331231221231211231222332231312233113223231322323112221232123113231311223132321132332212321132321322312311213122132312231232213211312112231123123312231323213221223311123233121332333211132133221233132233212113323221312311231323321311231122311112321233231132322131221333121213223221123213213233112322132311123231323321233121232231323221331213121132231121232211213321133122131122332131232112323132211232132321323113221323212132123213212312133222321231223312123311231332123112323123133212312231223311232132133122311232313121232132321321132331223112332133121321312231233112331213212133213121231123321332112331213321332123132132322113321331223113232123211321332121323233211231232311233212332113223123322131232113231211323132312321223132312332112313212312213321231212311231321233212231132123121332113213321213221331231122331321312232112323113212321133213223113221322133213212311)
else:
    history = str(1132123123312231223113223123311232123113232112322131231332213123133221132133222312123312311233121321231132212332123132113212132132123312213212313211233213232212321323132311213213123123122332)#古い->新しい

sepIndex = len(history) - int(len(history)/10)

#上の1,2,3の羅列から、AI用のデータに変換
(X,Y) = createData(history[0:sepIndex])

#上で使わなかった部分をテスト用にする
(X_test,Y_test) = createData(history[sepIndex:-1])

#学習回数
epochs = 1000

#AI作成
model = createModel(9,4,16,8,3)

#AI学習開始
result = model.fit(X, Y, nb_epoch=epochs, batch_size=int(len(X)/5))# 学習を実行

#AIの形を出力
model.summary()

#テスト(未知の手に対応できるか)
test(X_test,Y_test,result,model)

#最後2つから予測
targetList = []
ta = history[-3:]
for i in ta:
    if i == "1": targetList.extend([1,0,0])
    elif i == "2": targetList.extend([0,1,0])
    elif i == "3": targetList.extend([0,0,1])

print("最後の3つから次を予測 :",model.predict_proba(np.array([targetList])))